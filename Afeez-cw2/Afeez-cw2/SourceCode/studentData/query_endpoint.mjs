//Import AWS
import { SageMakerRuntimeClient, InvokeEndpointCommand } from "@aws-sdk/client-sagemaker-runtime"; 

//Create SageMakerRuntimeClient
const client = new SageMakerRuntimeClient({});

/* Data we are going to send to endpoint
    REPLACE WITH YOUR OWN DATA!
    Should be last 100 points in your time series (depending on your choice of hyperparameters).
    Make sure that start is correct.
*/
const endpointData = {
    "instances":
      [
        {
          "start":"2024-03-25 15:00:00",
          "target":[402.6270824593154,405.5453970973386,377.9040242599811,416.9537795560384,418.8919921545608,422.7740247348513,430.5781017336964,407.711712934114,449.2855821429266,424.27459926550483,448.0263156139199,458.7194138029914,477.16825884850135,471.4037669453457,481.6220214361883,482.50032965978403,469.1194957428298,471.48336101009414,440.969045319029,437.209292724467,458.1151037251597,434.14245501368487,439.8544677509638,401.6395602353549,414.55412131645846,412.27857706378154,407.65439201799865,422.78153445003613,437.694516009575,412.88506397760705,411.3184571035576,432.63534660876854,467.49048690836685,467.4600648638867,460.4006861987209,458.4429400167966,459.0147635008454,476.30750802586607,458.84151614479595,462.75485005675773,469.4410583317496,454.36307846734786,462.33273348039495,443.84924619691463,444.36171528775816,425.993544896092,434.6766154394464,439.4009798635379,411.55858269986174,436.4592616187139,448.231681155365,416.4188385140054,414.7514147262436,424.4115622037371,441.68334109438445,466.6356601668765,454.8283535236392,449.4176758579421,460.31326058708333,486.110997219624,478.37424461815453,487.04650786407444,501.5397521085471,516.420461472903,470.1760732913791,502.57004475328847,493.03994818448155,500.00536848843325,471.39360232132805,488.07644408528284,445.69882081316956,444.8185151499189,444.56520173190444,448.2881727613325,437.9002392647531,469.7266743738629,430.1456450686653,435.27296029078843,467.1152137726235,482.94533593093547,500.5303709959194,507.2199969216139,476.07304532517475,487.04060853586236,531.0719882186557,519.0930938448818,516.6974512787891,510.2298653232988,504.51441333243963,482.86623915597977,523.2424309819852,489.1900034340719,466.29512869639217,500.4524361735066,493.1906909676645,448.38315267776113,448.73328021907014,455.88908532107155,470.27059971180734,473.8369982128716]
        }
      ],
      "configuration":
         {
           "num_samples": 50,
            "output_types":["mean","quantiles","samples"],
            "quantiles":["0.1","0.9"]
         }
  }

//Calls endpoint and logs results
export async function invokeEndpoint () {
    //Create and send command with data
    const command = new InvokeEndpointCommand({
        EndpointName: "cw2-endpoint-afeez",
        Body: JSON.stringify(endpointData),
        ContentType: "application/json",
        Accept: "application/json"
    });
    const response = await client.send(command);

    //Must install @types/node for this to work
    let predictions = JSON.parse(Buffer.from(response.Body).toString('utf8'));

    return predictions
}

invokeEndpoint();